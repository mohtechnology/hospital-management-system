{% extends "base.html" %}

{% block content %}

<h3 class="mb-4">Doctor Dashboard</h3>

<h5>Create Availability Slots</h5>

<form method="POST" class="row g-3">
    {% csrf_token %}

    <div class="col-md-4">
        <label class="form-label"><b>Date</b></label>
        <input type="date" name="date" class="form-control" required>
    </div>

    <div class="col-md-4">
        <label class="form-label"><b>Start Time</b></label>
        <select name="start_time" class="form-select" required>
            {% for t in time_choices %}
                <option value="{{ t.value }}">{{ t.label }}</option>
            {% endfor %}
        </select>
    </div>

    <div class="col-md-4">
        <label class="form-label"><b>End Time</b></label>
        <select name="end_time" class="form-select" required>
            {% for t in time_choices %}
                <option value="{{ t.value }}">{{ t.label }}</option>
            {% endfor %}
        </select>
    </div>

    <input type="hidden" name="duration" value="30">

    <div class="col-12">
        <button class="btn btn-success mt-3">Generate Slots</button>
    </div>
</form>

<hr class="my-4">


<h5>Your Slots</h5>

<form method="GET" class="row g-3 mb-4">

    <div class="col-md-4">
        <label class="form-label"><b>Filter by Date</b></label>
        <select name="filter_date" class="form-select" onchange="this.form.submit()">
            <option value="">-- All Dates --</option>

            {% for d in available_dates %}
                <option value="{{ d|date:'Y-m-d' }}"
                    {% if selected_date == d|date:'Y-m-d' %} selected {% endif %}
                >
                    {{ d|date:'Y-m-d' }}
                </option>
            {% endfor %}
        </select>
    </div>

</form>


<table class="table table-bordered table-striped mt-3">
    <thead class="table-dark">
        <tr>
            <th>Start</th>
            <th>End</th>
            <th>Status</th>
        </tr>
    </thead>

    <tbody>
        {% for s in slots %}
        <tr>
            <td>{{ s.start|date:"Y-m-d H:i" }}</td>
            <td>{{ s.end|time:"H:i" }}</td>
            <td>
                {% if s.booked %}
                    <span class="badge bg-danger">Booked</span>
                {% else %}
                    <span class="badge bg-success">Available</span>
                {% endif %}
            </td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="3" class="text-center">No Slots Found</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

{% endblock %}
